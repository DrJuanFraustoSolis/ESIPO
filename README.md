ESIPO Methodology
ESIPO integrates five forecasting methods selected from the top-performing models of the international M4 competition: ARIMA, ETS, FFORMA, Jaganathan, and CNN. For portfolio optimization, ESIPO employs the GENPO and TAIPO algorithms, which are metaheuristics based on genetic algorithms and threshold accepting approaches, respectively, to select assets and optimize portfolio composition.

1. Software and Computational Environment
The experiments were conducted using Python 3.9 in Spyder 5.4.3, as well as R 4.4.2 in RStudio 4.4.2. To ensure reproducibility, the use of an Anaconda distribution is recommended. The following libraries must be installed with compatible versions:
Spyder 5.4.3 (Python libraries): NumPy,Pandas,Matplotlib,TensorFlow,Keras,Keras Tuner, Pandas DataReader, and yfinance

RStudio 4.4.2 (R packages):
•	readr
•	smooth
•	ggplot2
•	lubridate
•	forecast
•	forecastHybrid
•	prophet
•	xgboost
•	M4metalearning
•	M4metaresults
•	tsfeatures
•	TTR


2. Directory Structure and File Organization
Before executing the experiments, a working directory must be created containing the following scripts and data files:
Python scripts:
•	GENPO Publication.
•	CNN Hyperparameter Tuning Publication.
•	CNN Forecasting Publication.
•	SA Ensemble Publication.
•	TAIPO Optimization Publication.

R script:
•	ARIMA_ETS_JAGANATHAN_FFORMA_Forecasting_Publication.

Data files:
•	SP500_05_16_WK_572.csv: Input dataset containing 445 asset time series.
•	portf_initial_SP500_05_16_WK_572.csv: Initial portfolio configuration.
•	SP500_05_16_WK_66_ACT_TR458.csv: Training time series data used for turning (in-sample).
•	SP500_05_16_WK_66_ACT_VAL8.csv: Validation (out-of-sample) dataset used for turning.
•	SP500_05_16_WK_66_ACT_TRV515.csv: Training time series data used for forecasting.
•	SP500_05_16_WK_66_ACT_TEST_H8.csv: Test (out-of-sample) dataset used for forecasting with horizon H = 8.
•	forecasts_five_methods_SP500_2005_2016_weekly_H8.csv: Forecasts generated by the ARIMA, ETS, Jaganathan, FFORMA, and CNN models used in the ensemble.
•	SP500_05_16_WK_66_AST_TRV515-PEH8.csv: Dataset containing training and validation blocks, with H = 8 forecasts appended to the end of each asset time series.

3. Running the Algorithms
First Stage: Initial Portfolio Selection (GENPO)

To run the GENPO algorithm, follow the steps below:

1.	Open Spyder 5.4.3.
2.	Once the main interface is displayed, open the script named GENPO Publication.
3.	After loading the file, the main window will display the full algorithm script.
4.	Two execution options are available:
•	Option 1: Download asset data directly from Yahoo Finance (lines 31–56).
•	Option 2: Load a previously downloaded dataset from a CSV file (line 62).

In this experiment, Option 2 is used.
5.	Navigate to line 62 and specify the file path where the dataset SP500_05_16_WK_572.csv is stored.
6.	Execute the code using the Spyder console toolbar.
7.	The script automatically generates an output CSV file containing the results, named porf_initial_SP500_05_16_WK_572.csv (line 558). This file is required to run the second stage of the experimentation.

Second Stage: CNN Hyperparameter Tuning
To run the CNN hyperparameter tuning algorithm, follow the steps below:
1.	Open Spyder 5.4.3.
2.	Once the main interface is displayed, open the script named CNN Hyperparameter Tuning Publication.
3.	Navigate to line 32 and specify the file path where the training dataset SP500_05_16_WK_66_ACT_TR458.csv is stored.
4.	Navigate to line 33 and specify the file path where the validation dataset SP500_05_16_WK_66_ACT_VAL8.csv is stored.
5.	Navigate to line 232 and specify the output directory for the file named best_HP_SP500_05_16_WK_66_ACT_TR458-V_H8.csv.
6.	Execute the code using the Spyder console toolbar.
7.	The script automatically begins tuning the hyperparameters for each asset time series (lines 53–158).
8.	Once the tuning process is completed, an output file named best_HP_SP500_05_16_WK_66_ACT_TR458-V_H8.csv is generated (line 232). This file contains the optimal hyperparameters for each asset and is saved in the specified directory. It is required to run the third stage of the experimentation.

Third Stage: CNN Forecasting
To run the CNN Forecasting algorithm, follow the steps below:
1.	Open Spyder 5.4.3.
2.	Once the main interface is displayed, open the script named CNN Forecasting Publication.
3.	Navigate to line 39 and specify the file path where the training dataset SP500_05_16_WK_66_ACT_TRV515.csv is stored.
4.	Navigate to line 40 and specify the file path where the test (out-of-sample) dataset SP500_05_16_WK_66_ACT_TEST_H8.csv is stored.
5.	Navigate to line 62 and specify the file path to the hyperparameter file best_HP_SP500_05_16_WK_66_ACT_TR458-V_H8.csv.
6.	Execute the code using the Spyder console toolbar.
7.	The script automatically generates forecasts for each asset time series (lines 167–173).
8.	Forecast accuracy is evaluated using MAPE, sMAPE, and MSE to ensure comparability with standard forecasting benchmarks.
9.	Once the forecasting process is completed, two output files are generated automatically: forecasts_yhats_SP500_TRV_515-TEST_H8.csv (line 217) and error_metrics_SP500_TRV_515-TEST_H8.csv (line 213). These files are saved in the specified directory and are required to run the fourth stage of the experimentation.

Fourth Stage: ARIMA–ETS–JAGANATHAN–FFORMA Forecasting
To run the ARIMA–ETS–JAGANATHAN–FFORMA forecasting algorithm, follow the steps below:
1.	Open RStudio 4.4.2.
2.	Once the main interface is displayed, open the script named ARIMA_ETS_JAGANATHAN_FFORMA_Forecasting_Publication.
3.	Navigate to line 8 and specify the file path where the file porf_initial_SP500_05_16_WK_572.csv is stored.
4.	Navigate to line 152 and set the forecasting horizon to H = 8; then, at line 153, set the test block length to 57.
5.	Navigate to line 322 and specify the output directory for the file H8_results_unified_SP500_2005_2016_weekly_66_assets.csv.
6.	Navigate to line 326 and specify the output directory for the file H8_summary_metrics_by_method_SP500_2005_2016_weekly.csv.
7.	Navigate to line 377 and specify the output directory for the file H8_forecastsR_for_ensemble_4_methods_2005_2016_weekly_66_assets.csv.
8.	Navigate to line 381 and specify the output directory for the file H8_results_SP500_ARIMA_configs_2005_2016_weekly_66_assets.csv.
9.	Execute the code using the RStudio console toolbar.
10.	The script automatically generates forecasts for each asset time series using the four forecasting methods (lines 87–281).
11.	Once the forecasting process is completed, four output files are generated and saved in the specified directory. These files are required to run the fifth stage of the experimentation.
Fifth Stage: SA Ensemble

To run the SA Ensemble algorithm, follow the steps below:
1.	Open Spyder 5.4.3.
2.	Once the main interface is displayed, open the script named SA_Ensemble_Publication.
3.	Navigate to line 34 and specify the file path where the file forecasts_five_methods_SP500_2005_2016_weekly_H8.csv is stored.
4.	Execute the code using the Spyder console toolbar.
5.	The script automatically performs the forecast ensemble for the five forecasting methods across all asset time series (lines 37–203).
6.	Once the ensemble forecasting process is completed, three output files are generated and saved in the specified directory. These files are required to run the sixth stage of the experimentation.

Sixth Stage: TAIPO Optimization
To run the TAIPO Optimization algorithm, follow the steps below:
1.	Open Spyder 5.4.3.
2.	Once the main interface is displayed, open the script named TAIPO_Optimization_Publication.
3.	Navigate to line 40 and specify the file path where the file SP500_05_16_WK_66_AST_TRV515-PEH8 is stored.
4.	Navigate to line 518 and specify the file path where the output file summary_SP500_05_16_WK_66_AST-PE_H8 will be saved.
5.	Navigate to line 519 and specify the file path to save the output file Complete_portfolios_SP500_2005_2016_weekly_66_assets_PE_H8.
6.	Navigate to line 520 and specify the file path to save the output file solutions_SP500_05_16_WK_66_AST-PE_H8.
7.	Execute the code using the console toolbar.
8.	The script automatically performs the asset optimization process for each time series (lines 61–466).
9.	Once the optimization process is completed, three output files are generated and automatically saved in the specified directory.
4. Output Files

First Stage: Initial Portfolio Selection (GENPO)
The output files generated in this stage are as follows:
•	porf_initial_SP500_05_16_WK_572: Contains the time series of the 66 selected assets used to construct the initial portfolio, with rows representing time indices and columns corresponding to individual assets (line 558).
•	Additionally, the script generates a wide set of graphical outputs that provide clear visibility into the performance of key indicators and portfolio-related metrics (lines 604–677).

Second Stage: CNN Hyperparameter Tuning
The output files generated in this stage are as follows:
•	best_HP_SP500_05_16_WK_66_ACT_TR458-V_H8: CSV file containing the optimal hyperparameters identified for each asset during the tuning process (line 232).
•	error_metrics_SP500_05_16_WK_66_ACT_TR458-V_H8: CSV file containing the forecast evaluation metrics obtained during the hyperparameter tuning stage (line 243).
•	forecast_yhats_SP500_05_16_WK_66_ACT_TR458-V_H8: CSV file containing the forecasted values for each asset series generated during the hyperparameter tuning process (line 247).

Third Stage: CNN Forecasting
The output files generated in this stage are as follows:
•	models_SP500_TRV_515-TEST_H8: Directory containing the trained CNN models for each asset used to generate the forecasts (line 30). This directory is saved in the previously specified path.
•	error_metrics_SP500_TRV_515-TEST_H8: CSV file containing the forecast evaluation metrics for all assets (line 213).
•	forecast_yhats_SP500_TRV_515-TEST_H8: CSV file containing the forecasted values for each asset series produced in the forecasting stage (line 217).

Fourth Stage: ARIMA–ETS–JAGANATHAN–FFORMA Forecasting
The output files generated in this stage are as follows:
•	H8_results_unified_SP500_2005_2016_weekly_66_assets: CSV file containing detailed forecast evaluation metrics for each asset obtained from the four forecasting methods (ARIMA, ETS, JAGANATHAN, and FFORMA) (line 322).
•	H8_summary_metrics_by_method_SP500_2005_2016_weekly: CSV file containing the average forecast evaluation metrics for each forecasting method across all assets (line 325).
•	H8_forecastsR_for_ensemble_4_methods_2005_2016_weekly_66_assets: CSV file containing the forecasts generated by the ARIMA, ETS, JAGANATHAN, and FFORMA models, which are used as inputs for the ensemble stage (line 377).

Fifth Stage: SA Ensemble
The output files generated in this stage are as follows:
•	Average_results_ensemble_forecast_SA_SP500_2005_2016_weekly_H8: CSV file containing the average forecast evaluation metrics for each asset across the five forecasting methods included in the ensemble (line 221).
•	multiseries_consolidated_results_SP500_2005_2016_weekly_H8: CSV file containing detailed forecast evaluation metrics for each asset across the five forecasting methods (line 221).
•	optimal_multiseries_weights_SP500_2005_2016_weekly_H8: CSV file containing the optimal weight distribution used to construct the simulated annealing (SA) forecasting ensemble (line 228).
Sixth Stage: TAIPO Optimization

The output files generated in this stage are as follows:
•	summary_SP500_05_16_WK_66_AST-PE_H8: CSV file containing a summary of the 200 optimization experiments, including key performance metrics such as Sharpe ratio, expected return, risk, correlation, number of selected assets, and execution time (line 518).
•	Complete_portfolios_SP500_2005_2016_weekly_66_assets_PE_H8: CSV file containing the asset weight allocations for all portfolios generated across the 200 optimization experiments (line 519).
•	solutions_SP500_05_16_WK_66_AST-PE_H8: CSV file containing a detailed record of each internal iteration of the algorithm for the final portfolio, including Sharpe ratio, risk, expected return, correlation, and asset weights (line 520).
Note: All files required to execute the algorithms are consolidated in the same directory (……).
